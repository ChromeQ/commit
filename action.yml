name: Verified commit
description: Create a verified commit with GitHub Actions
inputs:
  path:
    description: Filesystem path of file to be committed
    required: true
runs:
  using: composite
  steps:
    - shell: bash
      run: |
        response=$( gh api graphql \
          --field owner=':owner' \
          --field repo=':repo' \
          --raw-field \
          query='query repoContents($owner: String!, $repo: String!) {
            repository(owner: $owner, name: $repo) {
              defaultBranchRef {
                name
                commit: target {
                  ... on Commit {
                    oid
                    tree {
                      oid
                    }
                  }
                }
              }
            }
          }' )
        head_sha=$( jq -r '.data.repository.defaultBranchRef.commit.oid' <<< "${response}" )
        tree_sha=$( jq -r '.data.repository.defaultBranchRef.commit.tree.oid' <<< "${response}" )
        echo "::set-output name=head-sha::$head_sha"
        echo "::set-output name=tree-sha::$tree_sha"
    - shell: bash
      run: |
        echo head SHA is: ${{ outputs.head-sha }}.
        echo tree SHA is: ${{ outputs.tree-sha }}.
